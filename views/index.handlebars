<!--<h2 class="page-header">Dashboard</h2>-->
<!--<p>Welcome to your dashboard</p>-->
<form class = "bs-example bs-example-form" style="margin-top: 20px" role = "form">
    <h3 style="padding-bottom: 5px">My Ebay Stores :</h3>

    <table id="StoreTable" class="table table-striped table-hover table-users">
        <thead>
        <tr>

            <th class="hidden-phone">Name</th>
            <th></th>
            <th></th>
            <!--<th class="hidden-phone">Token</th>-->
            <th class="hidden-phone"></th>
            <th class="hidden-phone"></th>
            <th></th>
            <th></th>
            <th></th>
        </tr>
        </thead>

        <tbody id="TableBody">

        </tbody>

    </table>
</form>

<form id="myform">
    <div class="form-group">
        <label>Add Another Store:</label>
        <a style="padding-left: 10px;" class="a_link" id="link_ebay"  href="#" data-click-prevent="true">
            <img src = "/ebay.png" style="padding-left:10px; height:50px;" class = "img-thumbnail">
            <!--<img data-ng-src="ebay.png" alt="eBay" class="store-logo" src="ebay.png">-->
        </a>
    </div>
</form>


<div class="container">
    <h3>Items Excluded : </h3>
    <!--<p>The .table-hover class enables a hover state on table rows:</p>-->
    <table id="ItemExcluded" class="table table-hover">
        <thead>
        <tr>
            <th>ItemId</th>
        </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>

<!--<div class="container">-->
    <!--<h2>Items Revoked : </h2>-->
    <!--&lt;!&ndash;<p>The .table-hover class enables a hover state on table rows:</p>&ndash;&gt;-->
    <!--<table id="ItemRevoked" class="table table-hover">-->
        <!--<thead>-->
        <!--<tr>-->
            <!--<th>Revoked ItemId</th>-->
            <!--<th>new ItemId</th>-->

        <!--</tr>-->
        <!--</thead>-->
        <!--<tbody>-->
        <!--<tr>-->
            <!--<td>John</td>-->
        <!--</tr>-->
        <!--</tbody>-->
    <!--</table>-->
<!--</div>-->

<form class = "bs-example bs-example-form" role = "form">
    <div class = "row">
        <div class = "col-lg-8">
            <div class = "input-group">
                <input type = "text" id="inputText" class = "form-control">
                <!--<input id="ex1" data-slider-id='ex1Slider' type="text" data-slider-min="0" data-slider-max="120" data-slider-step="1" data-slider-value="3"/>-->

                <span class = "input-group-btn">
                        <button id="addItem" class = "btn btn-success" type = "button">
                     Add Item
                        </button>
                        <button id="RemoveItem" class = "btn btn-danger" type = "button">
                     Remove Item
                     </button>

               </span>
            </div><!-- /input-group -->
        </div><!-- /.col-lg-6 -->
    </div><!-- /.row -->
</form>

<form class = "bs-example bs-example-form" style="margin-top: 20px" role = "form">
    <div class = "row">
        <div class = "col-lg-8">
            <div class = "input-group">
                <h3 style="padding-bottom: 5px">Number of Days :</h3>
                <input id="ex1" data-slider-id='ex1Slider' type="text" data-slider-min="1" data-slider-max="120" data-slider-step="1" data-slider-value="3"/>
                <!--<input id="ex1" data-slider-id='ex1Slider' type="text" data-slider-min="0" data-slider-max="120" data-slider-step="1" data-slider-value="3"/>-->
                <!--<span class = "input-group-btn">-->
                        <!--<button id="ChangeDay" class = "btn btn-info" type = "button">-->
                    <!--Save Setting-->
                        <!--</button>-->
               <!--</span>-->
            </div><!-- /input-group -->
        </div><!-- /.col-lg-6 -->
    </div>
</form>

<form class = "bs-example bs-example-form" style="margin-top: 20px" role = "form">
    <div class = "row">
        <div class = "col-lg-8">
            <div class = "input-group">
                <h3 style="padding-bottom: 5px">Image Angle to change :</h3>
                <input id="angle" data-slider-id='angleSlider' type="text" data-slider-min="0" data-slider-max="15" data-slider-step="1" data-slider-value="3"/>
                <!--<input id="ex1" data-slider-id='ex1Slider' type="text" data-slider-min="0" data-slider-max="120" data-slider-step="1" data-slider-value="3"/>-->
                <label id="disableRotation" style="margin-left: 20px" class="custom-control custom-checkbox">
                    <input id="disableCheckBox" type="checkbox" class="custom-control-input">
                    <span class="custom-control-indicator"></span>
                    <span class="custom-control-description">Disable picture rotation</span>
                </label>

            </div><!-- /input-group -->
        </div><!-- /.col-lg-6 -->
    </div>
</form>

<div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
        <h3 id="myModalLabel">Delete</h3>
    </div>
    <div class="modal-body">
        <p></p>
    </div>
    <div class="modal-footer">
        <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
        <button data-dismiss="modal" class="btn red" id="btnYes">Confirm</button>
    </div>
</div>

<form class = "bs-example bs-example-form" style="margin-top: 20px" role = "form">
    <h3 style="padding-bottom: 5px">Warning Items :</h3>

    <table id="WarningTable" class="table table-striped table-hover table-users">
        <thead>
        <tr>

            <th class="hidden-phone">Item ID</th>
            <th></th>
            <th></th>
            <!--<th class="hidden-phone">Token</th>-->
            <th class="hidden-phone"></th>
            <th class="hidden-phone"></th>
            <th></th>
            <th></th>
            <th></th>
        </tr>
        </thead>

        <tbody id="WarningTableBody">

        </tbody>

    </table>
</form>


    <script>
        $(document).on('click','.confirm-delete', function() {
            var id = $(this).data('id');
            //alert("id is "+id);
            $.post(
                    "/removeStore",{value:id},
                    function(data) {
                        //alert(data['status']);
                       window.location.reload(false);
                    }
            );

        });

        $(document).ready(function(){
        var table = document.getElementById("ItemExcluded");
        var StoreTable = document.getElementById("StoreTable");

        //var mySlider = $("input.slider").bootstrapSlider();

//        $('#ex1').slider({
//            formatter: function(value) {
//                return 'Current value: ' + value;
//            }
//        });
//            alert("loade")
//            function deleteMe() {
//                alert("im here 1");
//                $('.confirm-delete').on('click', function (e) {
//                    e.preventDefault();
//
//                    var id = $(this).data('id');
//                    alert(id);
//                });
//            }
//        }

        $.get(
                "/ExcludedToken",
                function(data) {
                    console.log(data);
                    //alert(data);
                    for (var i = 0; i < data.length; i++) {
                        //alert(data[i]);
                        var row = table.insertRow(i+1);
                        var cell = row.insertCell(0);
                        cell.innerHTML = data[i]
                    }
                }
        );


            $.get(
                    "/revokedItems",
                    function(data) {
                        console.log(data);
                        //alert(data);
                       // for (var i = 0; i < data.length; i++) {
                       //     alert(data[i]);
                       //     var row = table.insertRow(i+1);
                       //     var cell = row.insertCell(0);
                       //     cell.innerHTML = data[i]
                       // }

                        var jsonData = "text/json;charset=utf-8," + encodeURIComponent(data);

                        $('<a href="data:' + jsonData + '" download="revoked.csv">Download Revoked Item List</a>').appendTo('#WarningTable');
                    }
            );

            $("#disableRotation").click(function() {
                if($('#disableCheckBox')[0].checked) {
                    //alert("here1");
                    $("#angle").slider("disable");
                    var mySlider2 = $('#angle').slider();
                    var value2 = 0;
                    $.get(
                            "/updateAngle?value="+value2,
                            function(data) {
                                console.log(data);
                                //alert(data);
                            }
                    );
                    mySlider2.slider('setValue', value2)
                }
                else {
                    //alert("here2");
                    $("#angle").slider("enable");

                }
            });

        $("#link_ebay").on('click',function () {
            $('#myform').submit()
            //window.open("https://signin.sandbox.ebay.com/ws/eBayISAPI.dll?SignIn&RUName=shay_bar-shaybar-shaytes-qxsioxde&SessID=" + data.toString());
        });

        $('#myform').on('submit', function (e) {
            e.preventDefault();
            $.ajax({
                type: 'post',
                url: '/getMyEbay',
                success: function (data) {
                    //alert('form was submitted:'+ data);
                    window.open("https://signin.ebay.com/ws/eBayISAPI.dll?SignIn&RUName=G_DEALS-GDEALSc7f-43c1--ettpmtmup&SessID=" + data.toString());
                    //sleepFor();
                    //alert("starting to fetch");
                    $.ajax({
                        type: 'get',
                        url: '/fetchMyToken',
                        success: function (data) {
                            alert(data);
                        }
                    });
                    window.location.reload(false);
                }
            });
        });



        function sleepFor( sleepDuration ){
            var now = new Date().getTime();
            while(new Date().getTime() < now + sleepDuration){ /* do nothing */ }
        }

        $.get(
                "/days",
                function(data) {
                    var mySlider = $('#ex1').slider();
                    var num = parseInt(data);
                    mySlider.slider('setValue', num)
                }
        );

        $.get(
                "/getMyStores",
                function(data) {
                    console.log(data);
                    //alert(data);
                    if (data.length%2 != 0)
                        alert ("missing data or name");
                    else {
                        for (var i = 0; i < data.length / 2; i++) {
                            //alert(data[i]);
                            var strData = data[i + data.length / 2];
                            //var fragment = create('<tr><td>johnny</td> <td>john</td> <td>doe</td> <td>dsd@gmail.com</td> <td>active</td> <td>10/12/1999</td> <td><a>Delete</a></td></tr>');
                            //document.getElementById("TableBody").insertBefore(fragment, document.getElementById("TableBody").childNodes[0]);
                            document.getElementById("TableBody").insertAdjacentHTML('beforeend', '<tr><td style="min-width: 200px;">' + data[i] + '</td>  <td style="text-overflow: ellipsis;"></td> <td></td> <td></td> <td><a class="confirm-delete btn mini red-stripe" role="button" data-title="None" data-id="' + strData + '">Delete</a></td></tr>')
                        }
                    }
                }
        );


            $.get(
                    "/getMyWarningItems",
                    function(data) {
                        console.log(data);
                        //alert(data);
                        if (data.length == 0)
                            alert ("no warning item");
                        else {
                            for (var i = 0; i < data.length ; i++) {
                                //alert(data[i]);
                                var strData = data[i];
                                //var fragment = create('<tr><td>johnny</td> <td>john</td> <td>doe</td> <td>dsd@gmail.com</td> <td>active</td> <td>10/12/1999</td> <td><a>Delete</a></td></tr>');
                                //document.getElementById("TableBody").insertBefore(fragment, document.getElementById("TableBody").childNodes[0]);
                                document.getElementById("WarningTableBody").insertAdjacentHTML('beforeend', '<tr><td style="min-width: 200px;">' + data[i] + '</td>  <td style="text-overflow: ellipsis;"></td> <td></td> <td></td> <td></td></tr>')
                            }
                        }
                    }
            );

        $('#ChangeDay').click(function(){
            var mySlider = $('#ex1').slider();
            var value = mySlider.slider('getValue');
            $.get(
                    "/updateDays?value="+value,
                    function(data) {
                        console.log(data);
                        //alert(data);
                    }
            );
        });

//            $('#ex1').mouseup(function(){
//                alert('mouse up !!!');
//                var mySlider = $('#ex1').slider();
//                var value = mySlider.slider('getValue');
//                $.get(
//                        "/updateDays?value="+value,
//                        function(data) {
//                            console.log(data);
//                            alert(data);
//                        }
//                );
//            });

            $('#saveSettings').click(function(){
                var mySlider = $('#ex1').slider();
                var value = mySlider.slider('getValue');
                $.get(
                        "/updateDays?value="+value,
                        function(data) {
                            console.log(data);
                            //alert(data);
                        }
                );

                var mySlider2 = $('#angleSlider').slider();
                var value2 = mySlider2.slider('getValue');
                $.get(
                        "/updateAngle?value="+value2,
                        function(data) {
                            console.log(data);
                            //alert(data);
                        }
                );


            });

//            $('#ChangeAngle').click(function(){
//                var mySlider = $('#angleSlider').slider();
//                var value = mySlider.slider('getValue');
//                $.get(
//                        "/updateAngle?value="+value,
//                        function(data) {
//                            console.log(data);
//                            alert(data);
//                        }
//                );
//            });


            $.get(
                    "/Angle",
                    function(data) {
                        var mySlider = $('#angle').slider();
                        var num = parseInt(data);
                        mySlider.slider('setValue', num)

                        if (num == 0 ){
                            $('#disableCheckBox')[0].checked = true;
                            $("#angle").slider("disable");
                        }

                    }
            );

//        $('#myModal').on('show', function() {
//            var tit = $('.confirm-delete').data('title');
//
//            $('#myModal .modal-body p').html("Desea eliminar al usuario " + '<b>' + tit +'</b>' + ' ?');
//            var id = $(this).data('id'),
//                    removeBtn = $(this).find('.danger');
//        })

//        $('#btnYes').click(function() {
//            // handle deletion here
//            var id = $('#myModal').data('id');
//            $('[data-id='+id+']').parents('tr').remove();
//            $('#myModal').modal('hide');
//
//        });

        // With JQuery
        $('#ex1').slider({
            formatter: function(value) {
                return 'Current value: ' + value;
            }
        }).on('slideStop',function(sliderEvent){
            $.get(
                    "/updateDays?value="+sliderEvent.value,
                    function(data) {
                        console.log(data);
                        //alert(data);
                    }
            );
        });
            $('#angle').slider({
                formatter: function(value) {
                    return 'Current value: ' + value;
                }
            }).on('slideStop',function(sliderEvent){
                $.get(
                        "/updateAngle?value="+sliderEvent.value,
                        function(data) {
                            console.log(data);
                            //alert(data);
                        }
                );
            });


//            $('#ex1').slider({
//                from: 0, to: 120, smooth: true, step: 1, round: 0,
//                callback: function (value) {
//                    alert(value)
//
//                }
//            });


        $("#addItem").click(function(){
            var rowCount = $('#ItemExcluded tr').length;
            var text = $('#inputText').val();


            var tableRow = $("td").filter(function() {
                return $(this).text() == text;
            }).closest("tr");

            if (tableRow.length > 0 ){
                //alert("Table id already exist");
                return ;
            }

            // no issues with adding the items :
            $.get(
                    "/insertExcludedToken?value="+text,
                    function(data) {
                        var row = table.insertRow(rowCount);
                        var cell1 = row.insertCell(0);
                        cell1.innerHTML = text;

                    }
            );
        });

        $("#RemoveItem").click(function(){
            var texts = $('#inputText').val();
            var tableRow = $("td").filter(function() {
                return $(this).text() == texts;
            }).closest("tr");

            if (tableRow.length > 0 ){
                $.get(
                        "/removeExcludedToken?value="+texts,
                        function(data) {
                            tableRow.remove()
                        }
                );

            }
            else {
                //alert("Table id is not exist");
            }
        });



        });
</script>